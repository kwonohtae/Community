<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layout}">

<head>
<title>사용자 관리</title>
</head>

<th:block layout:fragment="content">
	<h1 class="mb-4">사용자 관리</h1>
	<table class="table table-hover">
		<thead class="thead-dark">
			<tr>
				<th>#</th>
				<th>아이디</th>
				<th>이름</th>
				<th>닉네임</th>
				<th>이메일</th>
				<th>권한</th>
				<th>가입일</th>
				<th>
					<button class="btn btn-primary btn-sm" onclick="openAddUserModal();">신규 유저 등록</button>
				</th>
			</tr>
		</thead>
		<tbody>
			<tr th:if="${userList.isEmpty()}">
				<td colspan="8" class="text-center">등록된 사용자가 없습니다.</td>
			</tr>
			<tr th:each="user, stat : ${userList}">
				<td th:text="${stat.count}"></td>
				<td th:text="${user.userId}"></td>
				<td th:text="${user.userName}"></td>
				<td th:text="${user.userNickName}"></td>
				<td th:text="${user.userEmail}"></td>
				<td th:text="${user.role}"></td>
				<td
					th:text="${#temporals.format(user.insertDate != null ? user.insertDate : null, 'yyyy-MM-dd HH:mm')}"></td>
				<td>
					<button class="btn btn-sm btn-info"
						th:attr="data-user-id=${user.userId != null ? user.userId : ''}, 
                                         data-user-name=${user.userName != null ? user.userName : ''}, 
                                         data-user-nick-name=${user.userNickName != null ? user.userNickName : ''},
                                         data-user-email=${user.userEmail != null ? user.userEmail : ''},
                                         data-user-phone=${user.userPhone != null ? user.userPhone : ''},
                                         data-user-role=${user.role != null ? user.role : ''}"
						onclick="openEditUserModal(this)">수정</button>
					<button class="btn btn-sm btn-danger"
						th:attr="data-user-id=${user.userId}"
						onclick="confirmDeleteUser(this)">삭제</button>
				</td>
			</tr>
		</tbody>
	</table>

	<!-- Pagination -->
	<nav aria-label="Page navigation">
		<ul class="pagination justify-content-center">
			<li class="page-item"
				th:classappend="${currentPage == 1} ? 'disabled'"><a
				class="page-link" th:href="@{''(page=${currentPage - 1})}"
				aria-label="Previous"> <span aria-hidden="true">&laquo;</span>
			</a></li>
			<li class="page-item"
				th:each="i : ${#numbers.sequence(1, totalPages)}"
				th:classappend="${i == currentPage} ? 'active'"><a
				class="page-link" th:href="@{''(page=${i})}" th:text="${i}"></a></li>
			<li class="page-item"
				th:classappend="${currentPage == totalPages} ? 'disabled'"><a
				class="page-link" th:href="@{''(page=${currentPage + 1})}"
				aria-label="Next"> <span aria-hidden="true">&raquo;</span>
			</a></li>
		</ul>
	</nav>

	<div class="d-flex justify-content-between">
		<a href="/admin/dashboard" class="btn btn-secondary">대시보드로 돌아가기</a>
	</div>
</th:block>
</body>
</html>
<th:block>
<!-- User Edit Modal -->
	<div class="modal fade" id="userEditModal" tabindex="-1"
		aria-labelledby="userEditModalLabel" aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="userEditModalLabel">사용자 정보 수정</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal"
						aria-label="Close"></button>
				</div>
				<div class="modal-body">
					<form id="userEditForm">
						<input type="hidden" id="editUserId" name="userId">
						<div class="mb-3">
							<label for="editUserName" class="form-label">이름</label> <input
								type="text" class="form-control" id="editUserName"
								name="userName">
						</div>
						<div class="mb-3">
							<label for="editUserNickName" class="form-label">닉네임</label> <input
								type="text" class="form-control" id="editUserNickName"
								name="userNickName">
						</div>
						<div class="mb-3">
							<label for="editUserEmail" class="form-label">이메일</label> <input
								type="email" class="form-control" id="editUserEmail"
								name="userEmail">
						</div>
						<div class="mb-3">
							<label for="editUserPhone" class="form-label">연락처</label> <input
								type="tel" class="form-control" id="editUserPhone"
								name="userPhone">
						</div>
						<div class="mb-3">
							<label for="editRole" class="form-label">권한</label> <select
								class="form-select" id="editRole" name="role">
								<option value="USER">USER</option>
								<option value="ADMIN">ADMIN</option>
							</select>
						</div>
					</form>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary"
						data-bs-dismiss="modal">닫기</button>
					<button type="button" class="btn btn-primary"
						id="saveUserChangesBtn">저장</button>
				</div>
			</div>
			</div>
	</div>
</th:block>
<th:block>
<!-- User Add Modal -->
	<div class="modal fade" id="userAddModal" tabindex="-1"
		aria-labelledby="userAddModalLabel" aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="userAddModalLabel">신규 사용자 등록</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal"
						aria-label="Close"></button>
				</div>
				<div class="modal-body">
					<form id="userAddForm">
						<div class="mb-3">
							<label for="addUserId" class="form-label">아이디</label> <input
								type="text" class="form-control" id="addUserId" name="userId"
								required>
						</div>
						<div class="mb-3">
							<label for="addUserPassword" class="form-label">비밀번호</label> <input
								type="password" class="form-control" id="addUserPassword"
								name="password" required>
						</div>
						<div class="mb-3">
							<label for="addUserName" class="form-label">이름</label> <input
								type="text" class="form-control" id="addUserName"
								name="userName" required>
						</div>
						<div class="mb-3">
							<label for="addUserNickName" class="form-label">닉네임</label> <input
								type="text" class="form-control" id="addUserNickName"
								name="userNickName">
						</div>
						<div class="mb-3">
							<label for="addUserEmail" class="form-label">이메일</label> <input
								type="email" class="form-control" id="addUserEmail"
								name="userEmail" required>
						</div>
						<div class="mb-3">
							<label for="addUserPhone" class="form-label">연락처</label> <input
								type="tel" class="form-control" id="addUserPhone"
								name="userPhone">
						</div>
						<div class="mb-3">
							<label for="addRole" class="form-label">권한</label> <select
								class="form-select" id="addRole" name="role">
								<option value="USER" selected>USER</option>
								<option value="ADMIN">ADMIN</option>
							</select>
						</div>
					</form>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary"
						data-bs-dismiss="modal">닫기</button>
					<button type="button" class="btn btn-primary" id="saveNewUserBtn">저장</button>
				</div>
			</div>
		</div>
	</div>
</th:block>

<th:block layout:fragment="script"></th:block>

<script>

	document.addEventListener("DOMContentLoaded", function(){
		console.log("확인!!");
	});
	
	function openAddUserModal (){
		console.log("신규 회원 가입 안내 modal 오픈")
		const modalElementAddUser = document.getElementById('userAddModal');
		if (modalElementAddUser) {
			document.getElementById('userAddForm').reset(); // 폼 초기화
			const userAddModal = new bootstrap.Modal(modalElementAddUser);
			userAddModal.show();
		}
	};
	
	function openEditUserModal(button){
		console.log("기존 회원 수정 안내 modal 오픈")
		const modalElementEditUser = document.getElementById('userEditModal');
		if (modalElementEditUser) {
			const constuserEditModal = new bootstrap.Modal(modalElementEditUser);
			constuserEditModal.show();
		}
	};

</script>